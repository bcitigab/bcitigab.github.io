<!DOCTYPE html>
<html lang="fr" >
<head>
  <meta charset="UTF-8">
  <title>Babillard B-Citi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="./style.css">
  <link href="https://vjs.zencdn.net/7.15.4/video-js.css" rel="stylesheet" />
  <script src="https://vjs.zencdn.net/7.15.4/video.min.js"></script>
  <script>var supportsES6 = (function () {
    try {
      new Function("(a=0)=>a");
      return true;
    } catch (e) {
      return false;
    }
  })();
  
  /**
   * Debounce function:
   * https://davidwalsh.name/function-debounce
   *
   * @param {function} func - Callback function to run.
   * @param {int} wait - How long in milliseconds to wait before firing.
   * @param {bool} imediate - Fire on the leading edge or trailing
   *
   */
  function debounce(func, wait, immediate) {
    var timeout;
    return function () {
      var context = this,
        args = arguments;
      var later = function () {
        timeout = null;
        if (!immediate) func.apply(context, args);
      };
      var callNow = immediate && !timeout;
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
      if (callNow) func.apply(context, args);
    };
  }
  
  function whichTransitionEvent() {
    var t;
    var el = document.createElement("fakeelement");
    var transitions = {
      WebkitTransition: "webkitTransitionEnd",
      MozTransition: "transitionend",
      MSTransition: "msTransitionEnd",
      OTransition: "oTransitionEnd",
      transition: "transitionEnd"
    };
  
    for (t in transitions) {
      if (el.style[t] !== undefined) {
        return transitions[t];
      }
    }
  }
  
  const fadeOutRemove = (obj) => {
    const transition = whichTransitionEvent();
    obj.classList.add("-js-fadeOutRemove");
    obj.setAttribute("hidden", true);
    obj.style = "display: none";
    // if (obj.hasAttribute('data-videoId')) return;
  
    // obj.addEventListener(transition, _ => {
    //   obj.setAttribute('hidden', true);
    //   obj.style = "width: 0; height: 0;";
    // });
  };
  
  const fadeOutAdd = (obj) => {
    const transition = whichTransitionEvent();
    obj.classList.remove("-js-fadeOutRemove");
    obj.setAttribute("hidden", false);
    obj.style = "display: block";
    /*
    TODO: Add smoother animation fade in/out
    */
    // if (obj.hasAttribute('data-videoId')) return;
    // obj.addEventListener(transition, _ => {
    //   obj.setAttribute('hidden', false);
    //   obj.style = "";
    // });
  };
  
  var VideoPlayer = (function (document) {
    "use strict";
    if (!supportsES6) return;
  
    /**
     * Lazyload Video
     *
     * @param {object} video - DOM node containing the video data as attributes.
     *
     */
    const lazyLoad = (video) => {
      const videoId = video.dataset.videoid;
      if (!videoId) return;
  
      const img = document.createElement("img");
      const imgSrc = "https://i.ytimg.com/vi/" + videoId + "/maxresdefault.jpg";
      img.src = imgSrc;
  
      // Optionally late-load the image (uses a different module)
      // img.setAttribute('data-LL-src', 'https://i.ytimg.com/vi/'+ videoId +'/hqdefault.jpg');
  
      const wrapper = document.createElement("div");
      wrapper.className = "video_cnt";
  
      const caption = document.createElement("div");
      caption.className = "video_caption";
  
      const category = document.createElement("p");
      category.className = "video_cat";
      category.setAttribute("data-matchHeights", "category");
      category.textContent = video.dataset.videocategory || "";
      const title = document.createElement("h3");
      title.className = "video_title";
      title.setAttribute("data-matchHeights", "title");
      title.textContent = video.dataset.videotitle || "";
      if (category.textContent.length) {
        caption.appendChild(category);
      }
      if (title.textContent.length) {
        caption.appendChild(title);
      }
      const playBtn = document.createElement("button");
      playBtn.type = "button";
      playBtn.classList.add("video_btn");
      playBtn.setAttribute(
        "aria-label",
        "Play video: " + video.dataset.videotitle
      );
      playBtn.setAttribute("aria-pressed", false);
      playBtn.innerHTML =
        '<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="none" viewBox="0 0 60 60"><path class="play" fill="#fff" d="M35.394 31.046l-9.544 5.538c-.81.469-1.85-.1-1.85-1.046V24.462c0-.945 1.038-1.515 1.85-1.044l9.544 5.538a1.203 1.203 0 010 2.09z"/><circle class="circle" cx="30" cy="30" r="28" stroke="#fff" stroke-width="4"/></svg>';
  
      // Remove listener if late-loading the image (leave its content in play)
      img.addEventListener(
        "load",
        (_) => {
          wrapper.style = `background-image: url('${imgSrc}');`;
          wrapper.appendChild(playBtn);
          wrapper.appendChild(caption);
          video.appendChild(wrapper);
        },
        { once: true }
      );
  
      const iframe = document.createElement("iframe");
      iframe.className = "video_iframe";
      iframe.setAttribute("frameborder", 0);
      iframe.setAttribute("allowfullscreen", "");
      iframe.setAttribute("title", "YouTube video of " + title);
  
      const getFrame = (e) => {
        if (e.target.querySelector(".video_iframe")) return;
  
        // Fade out and remove the button immediately
        // - Indicates action underway on slow networks
        // - Consider replacing with a loading indicator until loaded fully.
        fadeOutRemove(e.target);
  
        // Chrome will ignore autoplay and make the user click twice
        iframe.setAttribute(
          "src",
          "https://www.youtube.com/embed/" +
            videoId +
            "?rel=0&showinfo=0&autoplay=1"
        );
  
        // On iframe load - fade out image and title
        iframe.addEventListener(
          "load",
          (_) => {
            fadeOutRemove(wrapper);
          },
          { once: true }
        );
  
        // Place iframe behind the video_img (until fully loaded)
        video.prepend(iframe);
      };
  
      video.setAttribute("tabindex", 0);
      video.setAttribute("aria-title", "Video module: " + title);
      video.addEventListener("click", getFrame, { once: true });
    };
  
    // Remove event if in a separate .js file (leave its content in play)
    document.addEventListener("DOMContentLoaded", (e) => {
      const videos = document.querySelectorAll("[data-videoId]");
      for (const video of videos) {
        lazyLoad(video);
      }
    });
  })(document);
  
  var compareText = function (videos, element, compare) {
    // This regex matches the value of the input field, in either orientation or in part of a word
    const val =
        "^(?=.*\\b" +
        element.value.toLowerCase().trim().split(/\s+/).join("\\b)(?=.*\\b") +
        ").*$",
      // RegExp instance
      reg = RegExp(val, "i");
    // Filter the videos node array based on the regex pattern matching
    videos.filter((video) => {
      // Matches spaces and replaces with 'clean' spaces in the data-videotitle attr
      text = video.dataset[compare].toLowerCase().replace(/\s+/g, " ");
      // Test regex pattern against the value of text
      if (!reg.test(text)) {
        // hide video tile as it doesn't match the search
        fadeOutRemove(video);
        // video.style = "display: none";
      } else {
        // show everything that does match
        fadeOutAdd(video);
        // video.style = "display: block";
      }
    });
  };
  // Search by text
  var simpleSearch = (function (document) {
    // Check if ES6 is supported
  
    if (!supportsES6) return;
  
    // Search function
    const search = (videos, element) => {
      // Text to match against
      let text = "",
        compare = "videotitle",
        eventType = "keyup";
      /*
      Add event listener for key up, using debounce to avoid performance issues.
      See: https://davidwalsh.name/function-debounce
      
      Arguably could use a button input instead to 'submit' the search, but this is live-effect, depends what is preferred.
      */
      const nodeType = element.nodeName;
      if (nodeType == "SELECT") {
        eventType = "change";
        compare = "videocategory";
      }
      console.log(nodeType);
  
      element.addEventListener(
        eventType,
        debounce(function () {
          compareText(videos, element, compare);
        }),
        1000
      );
    };
    // Run on load
    document.addEventListener("DOMContentLoaded", (e) => {
      // Array of video tiles, using spread as nodelist isn't technically an array
      const videos = [...document.querySelectorAll(".tile")],
        // Get text input dom element
        input = document.querySelector("#searchBar"),
        select = document.querySelector("#filter");
      // Reset input val - probably a better way to do this without JS.
      input.value = "";
      select.value = "";
      // Call search
      search(videos, input);
      search(videos, select);
    });
  })(document);
  
  var matchHeights = function () {
    "use strict";
  
    var dataAttr = "data-matchHeights";
    var minViewportWidth = 460;
  
    function _getHeightSetsArray(dataAttr) {
      // Return an array containing the different values of data-data-heightmatch
      var value;
      var arr = [];
      var sets = document.querySelectorAll("[" + dataAttr + "]");
      var i = sets.length;
      while (i--) {
        value = sets[i].getAttribute(dataAttr);
        if (arr.indexOf(value) === -1) {
          arr.push(value);
        }
      }
      return arr;
    }
  
    function _resetMinHeights(set) {
      // reset min-heights by removing the inline style.
      var i = set.length;
      while (i--) {
        set[i].removeAttribute("style");
      }
    }
  
    function _getMaxSetHeight(set) {
      // return the height of the tallest element in set
      var maxHeight = 0;
      var currentHeight;
      var i = set.length;
      while (i--) {
        currentHeight = set[i].clientHeight;
        if (currentHeight > maxHeight) {
          maxHeight = currentHeight;
        }
      }
      return maxHeight;
    }
  
    function _setMinHeight(set, matchedHeight) {
      var i = set.length;
      while (i--) {
        set[i].style.minHeight = matchedHeight + "px";
      }
    }
  
    function init() {
      var sets = _getHeightSetsArray(dataAttr);
      var i = sets.length;
      var set;
  
      while (i--) {
        set = document.querySelectorAll("[" + dataAttr + '="' + sets[i] + '"]');
  
        _resetMinHeights(set);
  
        // Only above minimum screen width
        if (document.body.clientWidth >= minViewportWidth) {
          _setMinHeight(set, _getMaxSetHeight(set));
        }
      }
    }
  
    init();
  };
  
  window.addEventListener("load", matchHeights, false);
  window.addEventListener("resize", matchHeights, false);</script>
</head>
<body>
<!-- partial:index.partial.html -->
<section class="uol-section uol-section--primary">
  <h1 class="uol-h1 p-lr-20 center">Babillard B-Citi Brossard</h1>
  <p class="uol-t1 p-lr-20 center">Découvrez  les derniers contenus vidéos de la ville de Brossard.</p>
</section>
<section class="uol-section">
  <div class="center">
    <div class="uol-input-cnt">
      <label class="uol-label">Filtre <span class="visually-hidden">par catégorie</span></label>
      <select class="uol-input" id="filter">
        <option value="" selected>Choisissez une catégorie</option>
        <option value="municipales">Affaires municipales</option>
        <option value="commerce">Commerce</option>
        <option value="communautaire">Communautaire</option>
        <option value="famille">Famille</option>
        <option value="immobilier">Immobilier</option>
        <option value="sport">Sport</option>
        <option value="restaurant">Restaurant</option>
      </select>
    </div>
    <div class="uol-input-cnt">
      <label class="uol-label" for="#searchBar">Recherche <span class="visually-hidden">un vidéo</span></label>
      <input class="uol-input" id="searchBar" type="text" />
    </div>
  </div>
  <ul class="grid p-lr-20">
    <li class="tile tile-half" data-video-category="famille" data-video-title="Un été inoubliablea vec les camps de jour de Brossard!">
      <video id="my-video" class="video-js vjs-default-skin" controls preload="auto" width="640" height="264"
      poster="images/video1.png" data-setup="{}">
          <source src="videos/video1.mp4" type='video/mp4'>
      </video>
  </li>
    <li class="tile" data-videoid="VKJ_eecMmxw" data-videotitle="Séance du conseil municipal | 19 mars 2024" data-videocategory="municipales"></li>
    <li class="tile" data-videoCategory="sport" data-videotitle="ARS Rive-Sud. Ensemble pour le jeu !" data-videoid="rMcqGoU8c_g"></li>
    <li class="tile" data-videoid="Hx6_b-RLgXk" data-videotitle="Escapade en famille avec Patrick Langlois" data-videocategory="famille"></li>
    <li class="tile" data-videoid="SemAAWRBKeo" data-videotitle="Bénévoles et nos organismes brossardois " data-videocategory="communautaire"></li>
    <li class="tile tile-half" data-videoid="3s5_UnkqjrM" data-videotitle="La Pyrite et le Marché immobilier" data-videocategory="immobilier"></li>
    <li class="tile" data-videoid="Pm4DegyibyE" data-videotitle="Café Coton DIX30" data-videocategory="commerce"></li>
    <li class="tile" data-videoid="erEQLPmQGL8" data-videotitle="Salon des métiers d'art et salon des tendances créatives" data-videocategory="Communautaire"></li>
    <li class="tile" data-videoid="Cp8YFh9CVsM" data-videotitle="Chic - Lave auto à la main" data-videocategory="live lounge"></li>
    <li class="tile" data-videoid="DUENvN6v8Qc" data-videotitle="Café Kuya" data-videocategory="restaurant"></li>
  </ul>
</section>
<!-- partial -->
  <script  src="./script.js"></script>

</body>
</html>
